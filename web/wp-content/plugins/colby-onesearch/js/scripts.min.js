"use strict";var $=void 0,DID_YOU_MEAN_FILLED=!1,FACET_COUNTS_RECEIVED=!1,PARAMS=void 0,RESULTS=[],SEARCH_TYPES=["books","musicscores","journalarticles","journals","audio","video","libguides","libanswers","databases","digitalcommons","images"],getURLParameter=function(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o+=1){var a=n[o].split("=");if(e===a[0])return a[1]}return""},getURLParamString=function(e){null==e&&(e=window.location.href);var t=e.indexOf("?");return e.substring(t+1)},advancedToggler=function(){$(".advanced-toggler").click(function(){(void 0).toggleClass("active"),$(".advanced-options").toggleClass("active")})},doFallback=function(e,t){try{$.get(ajaxurl,PARAMS+"&box=fallback",function(n){for(var o=JSON.parse(n).html,a=0;a<o.length&&!(a+e>SEARCH_TYPES.length);a+=1)$("#bento-box-"+(a+e)).show(),$("#bento-box-"+(a+e)).append(o[a]),t+=1;t||($(".bento-column").prepend('<div class="bento-no-results">No results.</div>'),$(".facet-counts-container").hide()),$(".bento-cover").removeClass("active")})}catch(n){$(".bento-cover").removeClass("active")}},drawDidYouMean=function(e){if(e&&!DID_YOU_MEAN_FILLED&&e.did_you_mean){var t=getURLParamString(),n=getURLParameter("q"),o=t.replace(n,e.did_you_mean),a="Did you mean ";a+='<a href="?'+o+'">',a+=e.did_you_mean,a+="</a>?";var r=document.createElement("div"),c="<h3>Result Not Found</h3>";r.setAttribute("class","did-you-mean"),r.innerHTML=c+a,$("#did-you-mean").append(r),DID_YOU_MEAN_FILLED=!0}},gotResults=function(){RESULTS=processResultsJSON();for(var e=0,t=void 0,n=0;n<SEARCH_TYPES.length;n+=1)RESULTS[n]&&(drawDidYouMean(RESULTS[n]),RESULTS[n].facet_counts&&$(".facet-counts-container").append(RESULTS[n].facet_counts),RESULTS[n].html.indexOf("bento-result__title")===-1?($("#bento-box-"+n).hide(),t||(t=n)):($("#bento-box-"+n).append(RESULTS[n].html),e+=1));e<3?doFallback(t,e):$(".bento-cover").removeClass("active")},processResultsJSON=function(){for(var e=[],t=0;t<RESULTS.length;t+=1)e.push(JSON.parse(RESULTS[t]));return sortByScore(e)},runAjax=function(e,t){var n=t+"&box="+e;FACET_COUNTS_RECEIVED===!1&&(n+="&get_facet_counts=1",FACET_COUNTS_RECEIVED=!0);try{$.get(ajaxurl,n,function(e){RESULTS.push(e)}).fail(function(){})}catch(o){}},sortByScore=function e(t,n){if(0===t.length)return n;null==n&&(n=[]);for(var o=0,a=void 0,r=0;r<t.length;r+=1)o<=t[r].score&&(o=t[r].score,a=r);return n.push(t.splice(a,1)[0]),e(t,n)},waitForResults=function(e){var t=0,n=setInterval(function(){t+=1,(t>75||SEARCH_TYPES.length===RESULTS.length)&&(clearInterval(n),e())},200)},uncheckCheckboxes=function(){""===getURLParameter("online")&&$('input[name="online"]').removeAttr("checked"),""===getURLParameter("scholarly")&&$('input[name="scholarly"]').removeAttr("checked")};jQuery(document).ready(function(e){$=e,$(".bento-cover__logo").addClass("fadeout"),advancedToggler(),uncheckCheckboxes(),PARAMS=getURLParamString()+"&action=bentoAjaxRequest";for(var t=0;t<SEARCH_TYPES.length;t+=1)runAjax(SEARCH_TYPES[t],PARAMS);waitForResults(gotResults)});