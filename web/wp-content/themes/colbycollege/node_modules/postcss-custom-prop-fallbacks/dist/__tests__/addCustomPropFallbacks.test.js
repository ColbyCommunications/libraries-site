'use strict';

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _addCustomPropFallbacks = require('../addCustomPropFallbacks');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const getPreprocessedFile = () => new Promise(resolve => {
    _fs2.default.readFile(_path2.default.resolve(__dirname, 'example/style.css'), 'utf8', (err, data) => {
        if (err) {
            throw err;
        }

        resolve(data);
    });
});

const getProcessedFile = () => new Promise(resolve => {
    _fs2.default.readFile(_path2.default.resolve(__dirname, 'example/post-style.css'), 'utf8', (err, data) => {
        if (err) {
            throw err;
        }

        resolve(data);
    });
});

test('The test file is generated correctly.', async done => {
    const preprocessed = await getPreprocessedFile();
    const processed = await getProcessedFile();

    const root = _postcss2.default.parse(preprocessed);
    (0, _addCustomPropFallbacks.addCustomPropFallbacks)(root);
    expect(root.toString()).toBe(processed);

    done();
});